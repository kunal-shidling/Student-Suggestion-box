# Student Suggestion Box - Database Schema and API Documentation

## Database Schema

### Table: suggestions

```sql
CREATE TABLE suggestions (
  id BIGSERIAL PRIMARY KEY,
  student_name TEXT NOT NULL,
  department TEXT NOT NULL,
  suggestion_message TEXT NOT NULL,
  urgency TEXT NOT NULL CHECK (urgency IN ('low', 'medium', 'high')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Column Descriptions:
- **id**: Auto-incrementing primary key (BIGSERIAL)
- **student_name**: Name of the student submitting the suggestion (TEXT, NOT NULL)
- **department**: Department of the student (TEXT, NOT NULL)
- **suggestion_message**: The actual suggestion content (TEXT, NOT NULL)
- **urgency**: Priority level of the suggestion (TEXT, NOT NULL, must be 'low', 'medium', or 'high')
- **created_at**: Timestamp when the suggestion was created (TIMESTAMPTZ, defaults to current time)

## Row Level Security (RLS) Policies

### Enable RLS on suggestions table:
```sql
ALTER TABLE suggestions ENABLE ROW LEVEL SECURITY;
```

### Policy 1: Allow public to insert suggestions
```sql
CREATE POLICY "Allow public insert" ON suggestions
  FOR INSERT TO anon WITH CHECK (true);
```
- Allows anonymous users to create new suggestions

### Policy 2: Allow public to read suggestions
```sql
CREATE POLICY "Allow public select" ON suggestions
  FOR SELECT TO anon USING (true);
```
- Allows anonymous users to view all suggestions

## API Endpoints

Supabase automatically provides REST API endpoints:

### 1. Create New Suggestion
- **Endpoint**: `POST /rest/v1/suggestions`
- **Authentication**: Anonymous (anon key)
- **Request Body**:
```json
{
  "student_name": "string",
  "department": "string",
  "suggestion_message": "string",
  "urgency": "low" | "medium" | "high"
}
```
- **Response**: Returns the created suggestion object with id and created_at

### 2. Fetch Suggestions
- **Endpoint**: `GET /rest/v1/suggestions`
- **Authentication**: Anonymous (anon key)
- **Query Parameters**:
  - `order=created_at.desc` - Sort by newest first
  - `limit=<number>` - Limit number of results
  - Built-in ordering, filtering, and pagination support
- **Response**: Returns array of suggestion objects

## Data Validation Rules

### Field Requirements:
1. **student_name**:
   - Required (cannot be empty)
   - Type: String
   - Should contain valid text

2. **department**:
   - Required (cannot be empty)
   - Type: String
   - Should contain valid text

3. **suggestion_message**:
   - Required (cannot be empty)
   - Type: String
   - Should contain meaningful content

4. **urgency**:
   - Required (cannot be empty)
   - Type: String
   - Must be one of: 'low', 'medium', 'high'
   - Database constraint ensures only valid values

### Frontend Validation (Recommended):
- Check all fields are filled before submission
- Validate urgency is one of the three allowed values
- Trim whitespace from inputs
- Minimum length requirements for suggestion_message (e.g., at least 10 characters)
- Maximum length requirements to prevent abuse

### Database Constraints:
- NOT NULL constraints on all fields except id and created_at
- CHECK constraint on urgency field
- Primary key constraint on id
- Automatic timestamp on created_at

## Supabase Client Configuration

### Environment Variables:
```
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### Client Initialization:
```javascript
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  import.meta.env.VITE_SUPABASE_URL,
  import.meta.env.VITE_SUPABASE_ANON_KEY
);
```

## Example Usage

### Insert a Suggestion:
```javascript
const { data, error } = await supabase
  .from('suggestions')
  .insert([
    {
      student_name: 'John Doe',
      department: 'Computer Science',
      suggestion_message: 'Add more lab hours for students',
      urgency: 'medium'
    }
  ])
  .select();
```

### Fetch Latest Suggestion:
```javascript
const { data, error } = await supabase
  .from('suggestions')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(1)
  .single();
```

### Fetch All Suggestions:
```javascript
const { data, error } = await supabase
  .from('suggestions')
  .select('*')
  .order('created_at', { ascending: false });
```
